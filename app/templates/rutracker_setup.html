<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>RuTracker Setup</title>
    <style>
      :root {
        color-scheme: dark;
      }
      body {
        font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
        margin: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: radial-gradient(circle at top, #1e293b 0%, #0f172a 45%, #020617 100%);
        color: #e2e8f0;
      }
      .card {
        width: min(90vw, 560px);
        border: 1px solid rgba(148, 163, 184, 0.25);
        border-radius: 18px;
        padding: 2.4rem;
        box-shadow: 0 24px 55px rgba(2, 6, 23, 0.65);
        background: rgba(15, 23, 42, 0.92);
        backdrop-filter: blur(14px);
      }
      h1 {
        font-size: clamp(1.5rem, 1.8vw + 1rem, 2rem);
        margin: 0 0 0.75rem;
        font-weight: 700;
        letter-spacing: 0.35px;
      }
      .subtitle {
        color: #cbd5f5;
        margin-bottom: 1.5rem;
        font-size: 1.02rem;
        line-height: 1.55;
      }
      form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      label {
        font-weight: 600;
        letter-spacing: 0.25px;
        margin-bottom: 0.35rem;
      }
      input[type="text"],
      input[type="password"] {
        width: 100%;
        border-radius: 12px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        background: rgba(15, 23, 42, 0.65);
        padding: 0.85rem 0.95rem;
        font-size: 1rem;
        color: #f8fafc;
        transition: border 0.2s ease, box-shadow 0.2s ease;
        box-sizing: border-box;
      }
      input[type="text"]:focus,
      input[type="password"]:focus {
        outline: none;
        border-color: rgba(96, 165, 250, 0.9);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
      }
      .hint {
        color: #94a3b8;
        font-size: 0.92rem;
        line-height: 1.4;
      }
      .error {
        background: rgba(239, 68, 68, 0.12);
        border: 1px solid rgba(248, 113, 113, 0.35);
        color: #fee2e2;
        padding: 0.9rem 1rem;
        border-radius: 12px;
        margin-bottom: 0.8rem;
        line-height: 1.4;
      }
      button {
        margin-top: 0.5rem;
        padding: 0.9rem 1rem;
        font-size: 1.05rem;
        background: linear-gradient(135deg, #16a34a, #22d3ee);
        color: #0f172a;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
        letter-spacing: 0.3px;
        transition: transform 0.2s ease, box-shadow 0.2s ease, filter 0.2s ease;
      }
      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 18px 45px rgba(45, 212, 191, 0.35);
        filter: brightness(1.05);
      }
      button:active {
        transform: translateY(0);
      }
      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }
      .foot {
        color: #94a3b8;
        font-size: 0.92rem;
        margin-top: 1.8rem;
        border-top: 1px solid rgba(148, 163, 184, 0.25);
        padding-top: 1.1rem;
        line-height: 1.5;
      }
      code {
        background: rgba(30, 41, 59, 0.9);
        padding: 6px 10px;
        border-radius: 8px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        color: #f8fafc;
      }
      .status-indicator {
        display: none;
        padding: 1rem;
        border-radius: 12px;
        margin-bottom: 1rem;
        text-align: center;
        font-weight: 500;
      }
      .status-indicator.active {
        display: block;
      }
      .status-indicator.success {
        background: rgba(34, 197, 94, 0.12);
        border: 1px solid rgba(74, 222, 128, 0.35);
        color: #86efac;
      }
      .status-indicator.error {
        background: rgba(239, 68, 68, 0.12);
        border: 1px solid rgba(248, 113, 113, 0.35);
        color: #fca5a5;
      }
      @media (max-width: 520px) {
        .card {
          padding: 1.75rem 1.25rem;
          width: 95vw;
        }
        h1 {
          font-size: 1.4rem;
        }
        .subtitle {
          font-size: 0.95rem;
        }
        input[type="text"],
        input[type="password"] {
          padding: 0.95rem 1rem;
          font-size: 16px; /* Prevents zoom on iOS */
        }
        button {
          padding: 1rem;
          font-size: 1.1rem;
          min-height: 48px; /* Better touch target */
        }
        .hint {
          font-size: 0.88rem;
        }
        .foot {
          font-size: 0.85rem;
        }
      }
      @media (max-width: 380px) {
        .card {
          padding: 1.5rem 1rem;
        }
        h1 {
          font-size: 1.25rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>üè¥‚Äç‚ò†Ô∏è RuTracker Authorization</h1>
      <p class="subtitle">
        Enter your RuTracker username and password to enable torrent searching.
        These credentials will be saved securely in your <code>.env</code> file.
      </p>
      {{ERROR_BOX}}
      <div id="status-indicator" class="status-indicator"></div>
      <form id="rutracker-form" method="POST" action="/submit">
        <div>
          <label for="tracker_username">RuTracker Username</label>
          <input id="tracker_username" name="tracker_username" type="text" placeholder="Your username" value="{{TRACKER_USERNAME}}" required>
        </div>
        <div>
          <label for="tracker_password">RuTracker Password</label>
          <input id="tracker_password" name="tracker_password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value="{{TRACKER_PASSWORD}}" required>
        </div>
        <div>
          <label for="tracker_proxy">Tracker Proxy <span style="color: #94a3b8; font-weight: normal;">(optional)</span></label>
          <input id="tracker_proxy" name="tracker_proxy" type="text" placeholder="http://proxy.example.com:8080" value="{{TRACKER_PROXY}}">
          <p class="hint">Optional proxy server for RuTracker connections (e.g., http://proxy.example.com:8080)</p>
        </div>
        <button type="submit" id="submit-btn">Save Credentials</button>
      </form>
      <div class="foot">
        ‚Ä¢ Credentials are stored securely in your <code>.env</code> file on the device.<br>
        ‚Ä¢ You can update these credentials later by accessing this page again.
      </div>
    </div>
    <script>
      (function() {
        const form = document.getElementById('rutracker-form');
        const submitBtn = document.getElementById('submit-btn');
        const statusIndicator = document.getElementById('status-indicator');
        
        function showStatus(message, type) {
          statusIndicator.innerHTML = message;
          statusIndicator.className = 'status-indicator active ' + type;
        }
        
        function hideStatus() {
          statusIndicator.className = 'status-indicator';
        }
        
        form.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          submitBtn.disabled = true;
          hideStatus();
          
          const formData = new FormData(form);
          
          try {
            const response = await fetch('/submit', {
              method: 'POST',
              body: formData
            });
            
            const contentType = response.headers.get('content-type') || '';
            
            if (response.ok && contentType.includes('application/json')) {
              // Success
              showStatus('‚úÖ Credentials saved successfully! Redirecting...', 'success');
              setTimeout(() => {
                window.location.href = '/success';
              }, 1500);
            } else {
              // Error - show error message or reload page
              if (contentType.includes('text/html')) {
                // HTML error response - reload to show error
                window.location.reload();
              } else {
                // Try to parse as JSON for error message
                try {
                  const errorData = await response.json();
                  showStatus('‚ùå ' + (errorData.message || 'An error occurred. Please try again.'), 'error');
                } catch {
                  showStatus('‚ùå An error occurred. Please try again.', 'error');
                }
                submitBtn.disabled = false;
              }
            }
          } catch (error) {
            console.error('Submit error:', error);
            showStatus('‚ùå Network error. Please try again.', 'error');
            submitBtn.disabled = false;
          }
        });
      })();
    </script>
  </body>
</html>

